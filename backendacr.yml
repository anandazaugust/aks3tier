

trigger: none
pr: none



pool:
  vmImage: ubuntu-latest






parameters:


 - name: acrname
   type: string
   default: acrmar16

 - name: tier
   type: string
   default: 'frontend'
   values: 
     - frontend
     - backend
 - name: apiUrl
   type: string
    



  

variables:
 
  imageName-backend: 'backend'

  tag: $(Build.BuildId)   # Tag for your image

  dockerFilePath-backend: backend/Dockerfile


  
      

jobs:

 
 - job: onlyacrjobbackend
   displayName: onlyacrjob-backend
 
   steps:

        - task: AzureCLI@2
          displayName: login to ACR task
          inputs:
            azureSubscription: 'myaksfeb072025'
            scriptType: 'bash'
            scriptLocation: 'inlineScript'
            inlineScript: 'az acr login --name ${{ parameters.acrname }}'
          
        - script: |
            echo "npm installation..."
            cd backend
            npm install mysql2
            npm install
          displayName: 'installing npm'  
        

        - script: |
            echo "Building Docker image..."
            docker build -f $(dockerFilePath-backend) -t ${{ parameters.acrname }}.azurecr.io/$(imageName-backend):$(tag) .  # Build the image and tag it
          displayName: 'Build Docker Image script'

        - script: |
            echo "show docker image..."
            docker images
          displayName: 'show docker images script'

     
        - script: |
            echo "Pushing Docker image to ACR..."
            docker push ${{ parameters.acrname }}.azurecr.io/$(imageName-backend):$(tag)  # Push the image to ACR
          displayName: 'Push Docker Image to ACR script'

        - script: |
               docker tag ${{ parameters.acrname }}.azurecr.io/$(imageName-backend):$(tag) ${{ parameters.acrname }}.azurecr.io/$(imageName-backend):latest
               docker push ${{ parameters.acrname }}.azurecr.io/$(imageName-backend):latest
          displayName: tagging as latest and with buildid

        - script: |
             echo "show docker image..."
             docker images
          displayName: 'show docker images script'

